






<pre>
<font color="#0000ff">// Copyright (c) 2002  David Muse</font>
<font color="#0000ff">// See the file COPYING for more information</font>

<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/memorypool.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;stdio.h&gt;</font>

<font color="#a020f0">#ifdef RUDIMENTS_NAMESPACE</font>
<font color="#a52a2a"><b>using</b></font> <font color="#2e8b57"><b>namespace</b></font> rudiments;
<font color="#a020f0">#endif</font>

<font color="#2e8b57"><b>int</b></font> main(<font color="#2e8b57"><b>int</b></font> argc, <font color="#2e8b57"><b>const</b></font> <font color="#2e8b57"><b>char</b></font> **argv) {

        memorypool      *mp=<font color="#a52a2a"><b>new</b></font> memorypool(<font color="#ff00ff">32</font>,<font color="#ff00ff">16</font>,<font color="#ff00ff">10</font>);

        printf(<font color="#ff00ff">&quot;first run...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">20</font>; i++) {
                <font color="#2e8b57"><b>char</b></font>  *segment=(<font color="#2e8b57"><b>char</b></font> *)mp-&gt;malloc(<font color="#ff00ff">6</font>);
                <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> j=<font color="#ff00ff">0</font>; j&lt;<font color="#ff00ff">6</font>; j++) {
                        segment[j]=(<font color="#2e8b57"><b>char</b></font>)<font color="#ff00ff">'a'</font>+i;
                }
        }
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;free...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
        mp-&gt;free();
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;second run...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
        <font color="#2e8b57"><b>char</b></font>   *segment=(<font color="#2e8b57"><b>char</b></font> *)mp-&gt;malloc(<font color="#ff00ff">40</font>);
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> j=<font color="#ff00ff">0</font>; j&lt;<font color="#ff00ff">40</font>; j++) {
                segment[j]=<font color="#ff00ff">'z'</font>;
        }
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">20</font>; i++) {
                <font color="#2e8b57"><b>char</b></font>  *segment=(<font color="#2e8b57"><b>char</b></font> *)mp-&gt;malloc(<font color="#ff00ff">6</font>);
                <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> j=<font color="#ff00ff">0</font>; j&lt;<font color="#ff00ff">6</font>; j++) {
                        segment[j]=(<font color="#2e8b57"><b>char</b></font>)<font color="#ff00ff">'a'</font>+i;
                }
        }
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">20</font>; i++) {
                <font color="#2e8b57"><b>char</b></font>  *segment=(<font color="#2e8b57"><b>char</b></font> *)mp-&gt;malloc(<font color="#ff00ff">2</font>);
                <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> j=<font color="#ff00ff">0</font>; j&lt;<font color="#ff00ff">6</font>; j++) {
                        segment[j]=(<font color="#2e8b57"><b>char</b></font>)<font color="#ff00ff">'A'</font>+i;
                }
        }
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;free...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
        mp-&gt;free();
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;short/long/float/double...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);

        <font color="#2e8b57"><b>short</b></font>  *sp=(<font color="#2e8b57"><b>short</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>short</b></font>));
        <font color="#2e8b57"><b>long</b></font>   *lp=(<font color="#2e8b57"><b>long</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>long</b></font>));
        <font color="#2e8b57"><b>float</b></font>  *fp=(<font color="#2e8b57"><b>float</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>float</b></font>));
        <font color="#2e8b57"><b>double</b></font> *dp=(<font color="#2e8b57"><b>double</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>double</b></font>));
        *sp=<font color="#ff00ff">1</font>;
        *lp=<font color="#ff00ff">1</font>;
        *fp=<font color="#ff00ff">1.1</font>;
        *dp=<font color="#ff00ff">1.1</font>;

        printf(<font color="#ff00ff">&quot;sp: </font><font color="#6a5acd">%d</font><font color="#ff00ff">  lp: </font><font color="#6a5acd">%ld</font><font color="#ff00ff"> &quot;</font>,*sp,*lp);
        printf(<font color="#ff00ff">&quot;fp: </font><font color="#6a5acd">%f</font><font color="#ff00ff">  dp: </font><font color="#6a5acd">%f</font><font color="#ff00ff"> </font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,*fp,*dp);
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;free...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
        mp-&gt;free();
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;short/long/float/double arrays...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);

        <font color="#2e8b57"><b>short</b></font>  *spa=(<font color="#2e8b57"><b>short</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>short</b></font>)*<font color="#ff00ff">10</font>);
        <font color="#2e8b57"><b>long</b></font>   *lpa=(<font color="#2e8b57"><b>long</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>long</b></font>)*<font color="#ff00ff">10</font>);
        <font color="#2e8b57"><b>float</b></font>  *fpa=(<font color="#2e8b57"><b>float</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>float</b></font>)*<font color="#ff00ff">10</font>);
        <font color="#2e8b57"><b>double</b></font> *dpa=(<font color="#2e8b57"><b>double</b></font> *)mp-&gt;malloc(<font color="#a52a2a"><b>sizeof</b></font>(<font color="#2e8b57"><b>double</b></font>)*<font color="#ff00ff">10</font>);
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">10</font>; i++) {
                spa[i]=i;
                lpa[i]=i;
                fpa[i]=i+((<font color="#2e8b57"><b>float</b></font>)i/<font color="#ff00ff">10.0</font>);
                dpa[i]=i+((<font color="#2e8b57"><b>float</b></font>)i/<font color="#ff00ff">10.0</font>);
        }

        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">10</font>; i++) {
                printf(<font color="#ff00ff">&quot;sp: </font><font color="#6a5acd">%d</font><font color="#ff00ff">  lp: </font><font color="#6a5acd">%ld</font><font color="#ff00ff"> &quot;</font>,spa[i],lpa[i]);
                printf(<font color="#ff00ff">&quot;fp: </font><font color="#6a5acd">%f</font><font color="#ff00ff">  dp: </font><font color="#6a5acd">%f</font><font color="#ff00ff"> </font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,fpa[i],dpa[i]);
        }
        mp-&gt;print();

        printf(<font color="#ff00ff">&quot;free...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
        mp-&gt;free();
        mp-&gt;print();

        <font color="#a52a2a"><b>delete</b></font> mp;


        mp=<font color="#a52a2a"><b>new</b></font> memorypool(<font color="#ff00ff">32</font>,<font color="#ff00ff">16</font>,<font color="#ff00ff">10</font>);
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">10</font>; i++) {
                <font color="#2e8b57"><b>unsigned</b></font> <font color="#2e8b57"><b>long</b></font> total=<font color="#ff00ff">0</font>;
                <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>unsigned</b></font> <font color="#2e8b57"><b>long</b></font> j=<font color="#ff00ff">0</font>; j&lt;<font color="#ff00ff">11</font>; j++) {
                        total=total+i+j;
                        mp-&gt;malloc(i+j);
                        mp-&gt;free();
                }
                printf(<font color="#ff00ff">&quot;should be: </font><font color="#6a5acd">%ld</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,total/<font color="#ff00ff">11</font>);
                mp-&gt;print();
        }

        <font color="#a52a2a"><b>delete</b></font> mp;
}
</pre>


