






<pre>
<font color="#0000ff">// Copyright (c) 2001  David Muse</font>
<font color="#0000ff">// See the file COPYING for more information</font>

<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/sharedmemory.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/permissions.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/file.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/snooze.h&gt;</font>

<font color="#a020f0">#ifdef RUDIMENTS_NAMESPACE</font>
<font color="#a52a2a"><b>using</b></font> <font color="#2e8b57"><b>namespace</b></font> rudiments;
<font color="#a020f0">#endif</font>

<font color="#2e8b57"><b>int</b></font> main(<font color="#2e8b57"><b>int</b></font> argc, <font color="#2e8b57"><b>const</b></font> <font color="#2e8b57"><b>char</b></font> **argv) {

        <font color="#0000ff">// create a file called /tmp/shm</font>
        file::remove(<font color="#ff00ff">&quot;/tmp/shm&quot;</font>);
        file    fd;
        fd.create(<font color="#ff00ff">&quot;/tmp/shm&quot;</font>,permissions::evalPermString(<font color="#ff00ff">&quot;rw-------&quot;</font>));
        fd.close();

        <font color="#0000ff">// create a shared memory segment, keyed to /tmp/shm, 128 bytes long</font>
        sharedmemory    shm;
        shm.create(file::generateKey(<font color="#ff00ff">&quot;/tmp/shm&quot;</font>,<font color="#ff00ff">1</font>),<font color="#ff00ff">128</font>,
                                permissions::evalPermString(<font color="#ff00ff">&quot;rw-------&quot;</font>));

        <font color="#0000ff">// write a string into the shared memory</font>
        <font color="#2e8b57"><b>char</b></font>    *shmptr=(<font color="#2e8b57"><b>char</b></font> *)shm.getPointer();
        strcpy(shmptr,<font color="#ff00ff">&quot;This string is in shared memory.&quot;</font>);

        <font color="#0000ff">// sleep while another process accesses the shared memory...</font>
        snooze::macrosnooze(<font color="#ff00ff">1000</font>);
}
</pre>


