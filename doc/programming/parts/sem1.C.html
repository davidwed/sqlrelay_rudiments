






<pre>
<font color="#0000ff">// Copyright (c) 2001  David Muse</font>
<font color="#0000ff">// See the file COPYING for more information</font>

<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/semaphoreset.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/file.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/permissions.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;stdio.h&gt;</font>

<font color="#a020f0">#ifdef RUDIMENTS_NAMESPACE</font>
<font color="#a52a2a"><b>using</b></font> <font color="#2e8b57"><b>namespace</b></font> rudiments;
<font color="#a020f0">#endif</font>


<font color="#2e8b57"><b>int</b></font> main(<font color="#2e8b57"><b>int</b></font> argc, <font color="#2e8b57"><b>const</b></font> <font color="#2e8b57"><b>char</b></font> **argv) {

        <font color="#0000ff">// create a file called /tmp/sem</font>
        file::remove(<font color="#ff00ff">&quot;/tmp/sem&quot;</font>);
        file    fd;
        fd.create(<font color="#ff00ff">&quot;/tmp/sem&quot;</font>,permissions::evalPermString(<font color="#ff00ff">&quot;rw-------&quot;</font>));
        fd.close();

        <font color="#0000ff">// Create a semaphore set keyed to /tmp/sem containing 2 individual</font>
        <font color="#0000ff">// semaphores.  Initialize them to 0 and 1 respectively.</font>
        <font color="#2e8b57"><b>int</b></font>     vals[<font color="#ff00ff">2</font>]={<font color="#ff00ff">0</font>,<font color="#ff00ff">1</font>};
        semaphoreset    sem;
        sem.create(file::generateKey(<font color="#ff00ff">&quot;/tmp/sem&quot;</font>,<font color="#ff00ff">1</font>),
                        permissions::evalPermString(<font color="#ff00ff">&quot;rw-------&quot;</font>),<font color="#ff00ff">2</font>,vals);

        <font color="#0000ff">// loop 10 times, printing 2 and 4, synchronizing with another process</font>
        <font color="#0000ff">// using the semaphores.</font>
        <font color="#a52a2a"><b>for</b></font> (<font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>; i&lt;<font color="#ff00ff">10</font>; i++) {
                sem.wait(<font color="#ff00ff">0</font>);
                printf(<font color="#ff00ff">&quot;2</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
                sem.signal(<font color="#ff00ff">1</font>);

                sem.wait(<font color="#ff00ff">0</font>);
                printf(<font color="#ff00ff">&quot;4</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
                sem.signal(<font color="#ff00ff">1</font>);
        }
}
</pre>


