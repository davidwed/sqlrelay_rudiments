






<pre>
<font color="#0000ff">// Copyright (c) 2001  David Muse</font>
<font color="#0000ff">// See the file COPYING for more information</font>

<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/listener.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/inetserversocket.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/unixserversocket.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/inetclientsocket.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/unixclientsocket.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;rudiments/permissions.h&gt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;stdio.h&gt;</font>

<font color="#a020f0">#ifdef RUDIMENTS_NAMESPACE</font>
<font color="#a52a2a"><b>using</b></font> <font color="#2e8b57"><b>namespace</b></font> rudiments;
<font color="#a020f0">#endif</font>

<font color="#2e8b57"><b>int</b></font> main(<font color="#2e8b57"><b>int</b></font> argc, <font color="#2e8b57"><b>const</b></font> <font color="#2e8b57"><b>char</b></font> **argv) {

        inetserversocket        serversock;
        serversock.listen(<font color="#ff00ff">NULL</font>,<font color="#ff00ff">10000</font>,<font color="#ff00ff">15</font>);

        unixserversocket        handoffsock;
        handoffsock.listen(<font color="#ff00ff">&quot;/tmp/handoff.socket&quot;</font>,<font color="#a020f0">0</font><font color="#ff00ff">000</font>,<font color="#ff00ff">15</font>);

        listener        pool;
        pool.addFileDescriptor(&amp;serversock);
        pool.addFileDescriptor(&amp;handoffsock);

        inetclientsocket        *clientsock=<font color="#ff00ff">NULL</font>;
        unixclientsocket        *handoffclientsock=<font color="#ff00ff">NULL</font>;

        <font color="#a52a2a"><b>for</b></font> (;;) {

                pool.waitForNonBlockingRead(-<font color="#ff00ff">1</font>,-<font color="#ff00ff">1</font>);
                filedescriptor  *fd=<font color="#ff00ff">NULL</font>;
                pool.getReadyList()-&gt;getDataByIndex(<font color="#ff00ff">0</font>,&amp;fd);

                <font color="#a52a2a"><b>if</b></font> (fd==&amp;serversock) {
                        clientsock=(inetclientsocket *)
                                        serversock.accept();
                } <font color="#a52a2a"><b>else</b></font> <font color="#a52a2a"><b>if</b></font> (fd==&amp;handoffsock) {
                        handoffclientsock=(unixclientsocket *)
                                                handoffsock.accept();
                } <font color="#a52a2a"><b>else</b></font> {
                        printf(<font color="#ff00ff">&quot;error or timeout waiting...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);
                }

                <font color="#a52a2a"><b>if</b></font> (clientsock &amp;&amp; handoffclientsock) {
                        handoffclientsock-&gt;passFileDescriptor(
                                        clientsock-&gt;getFileDescriptor());
                        <font color="#a52a2a"><b>delete</b></font> clientsock;
                        clientsock=<font color="#ff00ff">NULL</font>;
                }
        }
}
</pre>


