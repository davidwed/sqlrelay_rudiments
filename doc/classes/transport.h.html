<html>
<head>
<title>/usr/local/src/rudiments/include/rudiments/transport.h.html</title>
<meta name="Generator" content="Vim/6.1">
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#0000f8">// Copyright (c) 2002 David Muse</font>
<font color="#0000f8">// See the COPYING file for more information.</font>

<font color="#a020f0">#ifndef TRANSPORT_H</font>
<font color="#a020f0">#define TRANSPORT_H</font>

<font color="#a020f0">#include </font><font color="#f800f8">&lt;strstream.h&gt;</font>

<font color="#a020f0">#include </font><font color="#f800f8">&lt;sys/types.h&gt;</font>

<font color="#a020f0">#include </font><font color="#f800f8">&lt;rudiments/errorhandler.h&gt;</font>

<font color="#0000f8">// The transport class is a base class for other classes that transport data</font>
<font color="#0000f8">// over (or associated with) a file descriptor (such as clients and servers).</font>

<font color="#288850"><b>class</b></font> transport : <font color="#a02828"><b>public</b></font> errorhandler {
        <font color="#a02828"><b>public</b></font>:
                        transport(<font color="#288850"><b>int</b></font> filedescriptor);
                                <font color="#0000f8">// Creates a transport and associates the</font>
                                <font color="#0000f8">// already open &quot;filedescriptor&quot; with it.</font>
                <font color="#288850"><b>virtual</b></font> ~transport();
                                <font color="#0000f8">// Calls close() if it hasn't already been</font>
                                <font color="#0000f8">// called.</font>


                <font color="#288850"><b>virtual</b></font> <font color="#288850"><b>int</b></font>     close();
                                <font color="#0000f8">// Closes the file descriptor.</font>
                                <font color="#0000f8">// Returns 1 on success and 0 on failure.</font>

                <font color="#288850"><b>virtual</b></font> <font color="#288850"><b>int</b></font>     getFileDescriptor() <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Returns the file descriptor.</font>


                <font color="#0000f8">// Write methods - write data to the file descriptor.</font>
                <font color="#0000f8">// These methods return the number of bytes that were</font>
                <font color="#0000f8">// successfully written.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>unsigned</b></font> <font color="#288850"><b>short</b></font> number) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;number&quot; to the file descriptor.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>unsigned</b></font> <font color="#288850"><b>long</b></font> number) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;number&quot; to the file descriptor.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>float</b></font> number) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;number&quot; to the file descriptor.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>double</b></font> number) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;number&quot; to the file descriptor.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>char</b></font> character) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;character&quot; to the file descriptor.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>const</b></font> <font color="#288850"><b>char</b></font> *string) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;string&quot; to the file descriptor.  Note</font>
                                <font color="#0000f8">// that &quot;string&quot; must be NULL-terminated.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>const</b></font> <font color="#288850"><b>char</b></font> *string, <font color="#288850"><b>size_t</b></font> size) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;size&quot; bytes from &quot;string&quot; to the file</font>
                                <font color="#0000f8">// descriptor.  Note that it is possible to</font>
                                <font color="#0000f8">// write beyond the string's NULL terminator</font>
                                <font color="#0000f8">// using this method.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t write(<font color="#288850"><b>const</b></font> <font color="#288850"><b>void</b></font> *buffer, <font color="#288850"><b>size_t</b></font> size) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Write &quot;size&quot; bytes from &quot;buffer&quot; to the file</font>
                                <font color="#0000f8">// descriptor.</font>


                <font color="#0000f8">// Read methods - read data to the file descriptor.</font>
                <font color="#0000f8">// These methods return the number of bytes that were</font>
                <font color="#0000f8">// successfully read.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>unsigned</b></font> <font color="#288850"><b>short</b></font> *buffer) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads sizeof(unsigned short) bytes</font>
                                <font color="#0000f8">// from the file descriptor into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>unsigned</b></font> <font color="#288850"><b>long</b></font> *buffer) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads sizeof(unsigned long) bytes</font>
                                <font color="#0000f8">// from the file descriptor into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>float</b></font> *buffer) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads sizeof(float) bytes from the file</font>
                                <font color="#0000f8">// descriptor into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>double</b></font> *buffer) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads sizeof(double) bytes from the file</font>
                                <font color="#0000f8">// descriptor into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>char</b></font> *buffer) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads sizeof(char) bytes from the file</font>
                                <font color="#0000f8">// descriptor into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>char</b></font> *buffer, <font color="#288850"><b>size_t</b></font> size) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads &quot;size&quot; bytes from the file descriptor</font>
                                <font color="#0000f8">// into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(<font color="#288850"><b>void</b></font> *buf, <font color="#288850"><b>size_t</b></font> size) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads &quot;size&quot; bytes from the file descriptor</font>
                                <font color="#0000f8">// into &quot;buffer&quot;.</font>
                <font color="#288850"><b>virtual</b></font> ssize_t read(strstream *buffer, <font color="#288850"><b>char</b></font> *terminator) <font color="#288850"><b>const</b></font>;
                                <font color="#0000f8">// Reads from the file desciptor into &quot;buffer&quot;</font>
                                <font color="#0000f8">// until &quot;terminator&quot; is encountered.</font>


                <font color="#0000f8">// By default, if a read or write is occurring and a signal</font>
                <font color="#0000f8">// interrupts it, the read or write returns with errno set to</font>
                <font color="#0000f8">// EINTR and must be retried.  These methods override that</font>
                <font color="#0000f8">// behavior.</font>
                <font color="#288850"><b>void</b></font>    retryInterruptedReads();
                        <font color="#0000f8">// Causes reads to automatically retry if interrupted</font>
                        <font color="#0000f8">// by a signal.</font>
                <font color="#288850"><b>void</b></font>    dontRetryInterruptedReads();
                        <font color="#0000f8">// Causes reads not to automatically retry if</font>
                        <font color="#0000f8">// interrupted by a signal.  This is the default.</font>
                <font color="#288850"><b>void</b></font>    retryInterruptedWrites();
                        <font color="#0000f8">// Causes writes not to automatically retry if</font>
                        <font color="#0000f8">// interrupted by a signal.  This is the default.</font>
                <font color="#288850"><b>void</b></font>    dontRetryInterruptedWrites();
                        <font color="#0000f8">// Causes writes not to automatically retry if</font>
                        <font color="#0000f8">// interrupted by a signal.  This is the default.</font>

<font color="#a020f0">        #include </font><font color="#f800f8">&lt;rudiments/private/transport.h&gt;</font>
};

<font color="#a020f0">#include </font><font color="#f800f8">&lt;rudiments/private/transportinlines.h&gt;</font>

<font color="#a020f0">#endif</font>
</pre>
</body>
</html>
