%define ver @VERSION@
%define rel 1
%define prefix @prefix@
%define exec_prefix @exec_prefix@
%define bindir @bindir@
%define libdir @libdir@
%define incdir @includedir@

Summary: C++ class library for daemons, clients and servers.
Name: rudiments
Version: %{ver}
Release: %{rel}
Source: http://www.firstworks.com/downloads/rudiments/%{name}-%{ver}.tar.gz
Copyright: LGPL
URL: http://www.firstworks.com
Group: System Environment/Libraries
Packager: David Muse <mused@firstworks.com>
Buildroot: /var/tmp/%{name}-root

%description
Rudiments is an Open Source C++ class library providing base classes for things
such as daemons, clients and servers, and wrapper classes for the standard
C functions for things like such as regular expressions, semaphores and signal 
handling.

%package devel
Summary: Libraries, includes and docs for development with rudiments.
Requires: %{name} = %{ver}
Group: Development/Libraries

%description devel
Rudiments is an Open Source C++ class library providing base classes for things
such as daemons, clients and servers, and wrapper classes for the standard
C functions for things like such as regular expressions, semaphores and signal 
handling.

%prep
rm -rf $RPM_BUILD_ROOT

%setup
%build
make clean
make unconfig
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{prefix}
make

%install
make prefix=${RPM_BUILD_ROOT}%{prefix} install

%post
NEWLIBDIR=`echo "%{libdir}" | sed -e "s|\/|\\\\\/|g"`
NEWLDSOCONF=`sed -e "/^$NEWLIBDIR$/d" /etc/ld.so.conf`
echo "$NEWLDSOCONF" > /etc/ld.so.conf
echo /usr/local/firstworks/lib >> /etc/ld.so.conf
/sbin/ldconfig

%postun
if ( test ! -d "%{libdir}" ); then
	NEWLIBDIR=`echo "%{libdir}" | sed -e "s|\/|\\\\\/|g"`
	NEWLDSOCONF=`sed -e "/^$NEWLIBDIR$/d" /etc/ld.so.conf`
	echo "$NEWLDSOCONF" > /etc/ld.so.conf
	/sbin/ldconfig
fi

%clean
rm -rf ${RPM_BUILD_ROOT}

%files
%defattr(-,root,root)
%{libdir}/librudiments.so.*

%files devel
%defattr(-,root,root)
%{bindir}/rudiments-config
%{libdir}/librudiments.a
%{libdir}/librudiments_p.a
%{libdir}/librudiments.so
%{incdir}/rudiments/private/transport.h
%{incdir}/rudiments/private/commandline.h
%{incdir}/rudiments/private/daemonprocess.h
%{incdir}/rudiments/private/datetime.h
%{incdir}/rudiments/private/filedestination.h
%{incdir}/rudiments/private/inetsocket.h
%{incdir}/rudiments/private/logdestination.h
%{incdir}/rudiments/private/logdestnode.h
%{incdir}/rudiments/private/logger.h
%{incdir}/rudiments/private/regularexpression.h
%{incdir}/rudiments/private/semaphoreset.h
%{incdir}/rudiments/private/unixserversocket.h
%{incdir}/rudiments/private/unixsocket.h
%{incdir}/rudiments/private/sharedmemory.h
%{incdir}/rudiments/private/signalhandler.h
%{incdir}/rudiments/private/signalset.h
%{incdir}/rudiments/private/listener.h
%{incdir}/rudiments/private/stderrdestination.h
%{incdir}/rudiments/private/stdoutdestination.h
%{incdir}/rudiments/private/syslogdestination.h
%{incdir}/rudiments/private/filedescriptornode.h
%{incdir}/rudiments/private/xmlsax.h
%{incdir}/rudiments/private/serversocket.h
%{incdir}/rudiments/private/clienttransport.h
%{incdir}/rudiments/private/xmldomnode.h
%{incdir}/rudiments/private/errorhandler.h
%{incdir}/rudiments/private/xmldom.h
%{incdir}/rudiments/private/memorypool.h
%{incdir}/rudiments/private/memorypoolnode.h
%{incdir}/rudiments/private/transportinlines.h
%{incdir}/rudiments/private/daemonprocessinlines.h
%{incdir}/rudiments/private/config.h.in
%{incdir}/rudiments/private/datetimeinlines.h
%{incdir}/rudiments/private/errorhandlerinlines.h
%{incdir}/rudiments/private/inetserversocketinlines.h
%{incdir}/rudiments/private/commandlineinlines.h
%{incdir}/rudiments/private/inetclientsocketinlines.h
%{incdir}/rudiments/private/listenerinlines.h
%{incdir}/rudiments/private/loggerinlines.h
%{incdir}/rudiments/private/memorypoolinlines.h
%{incdir}/rudiments/private/permissionsinlines.h
%{incdir}/rudiments/private/randomnumberinlines.h
%{incdir}/rudiments/private/regularexpressioninlines.h
%{incdir}/rudiments/private/signalclassesinlines.h
%{incdir}/rudiments/private/textinlines.h
%{incdir}/rudiments/private/unixclientsocketinlines.h
%{incdir}/rudiments/private/unixsocketinlines.h
%{incdir}/rudiments/private/xmldominlines.h
%{incdir}/rudiments/private/xmlsaxinlines.h
%{incdir}/rudiments/private/xmldomnodeinlines.h
%{incdir}/rudiments/private/config.h
%{incdir}/rudiments/errorhandler.h
%{incdir}/rudiments/commandline.h
%{incdir}/rudiments/daemonprocess.h
%{incdir}/rudiments/datetime.h
%{incdir}/rudiments/xmldom.h
%{incdir}/rudiments/logger.h
%{incdir}/rudiments/memorypool.h
%{incdir}/rudiments/randomnumber.h
%{incdir}/rudiments/regularexpression.h
%{incdir}/rudiments/semaphoreset.h
%{incdir}/rudiments/transport.h
%{incdir}/rudiments/listener.h
%{incdir}/rudiments/sharedmemory.h
%{incdir}/rudiments/signalclasses.h
%{incdir}/rudiments/text.h
%{incdir}/rudiments/inetclientsocket.h
%{incdir}/rudiments/inetserversocket.h
%{incdir}/rudiments/xmlsax.h
%{incdir}/rudiments/xmldomnode.h
%{incdir}/rudiments/permissions.h
%{incdir}/rudiments/unixclientsocket.h
%{incdir}/rudiments/unixserversocket.h
%{prefix}/doc/rudiments/guide.html
%{prefix}/doc/rudiments/index.html
%{prefix}/doc/rudiments/introduction.html
%{prefix}/doc/rudiments/invisible.gif
%{prefix}/doc/rudiments/reference.html
%{prefix}/doc/rudiments/classes/clientsocket.h.html
%{prefix}/doc/rudiments/classes/commandline.h.html
%{prefix}/doc/rudiments/classes/daemonprocess.h.html
%{prefix}/doc/rudiments/classes/datetime.h.html
%{prefix}/doc/rudiments/classes/genericsocket.h.html
%{prefix}/doc/rudiments/classes/permissions.h.html
%{prefix}/doc/rudiments/classes/randomnumber.h.html
%{prefix}/doc/rudiments/classes/regularexpression.h.html
%{prefix}/doc/rudiments/classes/semaphoreset.h.html
%{prefix}/doc/rudiments/classes/serversocket.h.html
%{prefix}/doc/rudiments/classes/serversocketpool.h.html
%{prefix}/doc/rudiments/classes/sharedmemory.h.html
%{prefix}/doc/rudiments/classes/signalclasses.h.html
%{prefix}/doc/rudiments/classes/text.h.html
%{prefix}/doc/rudiments/css/styles.css
%{prefix}/doc/rudiments/programming/baseclasses.html
%{prefix}/doc/rudiments/programming/utilclasses.html
